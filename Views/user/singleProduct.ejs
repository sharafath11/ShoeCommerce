<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="shortcut icon" href="/logo.png" />
    <meta name="author" content="CodePixar" />

    <meta name="description" content="" />

    <meta name="keywords" content="" />

    <meta charset="UTF-8" />

    <title>ST Shop</title>

    <link rel="stylesheet" href="/css/linearicons.css" />
    <link rel="stylesheet" href="/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/themify-icons.css" />
    <link rel="stylesheet" href="/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/owl.carousel.css" />
    <link rel="stylesheet" href="/css/nice-select.css" />
    <link rel="stylesheet" href="/css/nouislider.min.css" />
    <link rel="stylesheet" href="/css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="/css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="/css/magnific-popup.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/main.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<!-- SweetAlert2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="/user/css/singleProduct.css" />
  </head>
  <body>
    <header class="header_area sticky-header">
      <div class="main_menu">
          <nav class="navbar navbar-expand-lg navbar-light main_box">
              <div class="container">
                  <a class="navbar-brand logo_h" href="/">
                      <img src="/img/logo.png" alt="Logo" style="width: 123px; height: 75px;">
                  </a>
  
                  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </button>
  
                  <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                      <ul class="nav navbar-nav menu_nav ml-auto">
                          <li class="nav-item" id="home"><a class="nav-link" href="/">HOME</a></li>
                          <li class="nav-item" id="shop"><a class="nav-link" href="/shop">SHOP</a></li>
                          <!-- <li class="nav-item" id="checkout"><a class="nav-link" href="/checkout">CHECK OUT</a></li> -->
                          <li class="nav-item" id="contact"><a class="nav-link" href="/contact">CONTACT</a></li>
  
                          <li class="nav-item">
                              <a href="/wishlist" class="cart nav-link">
                                  <div class="cart-container">
                                      <span class="qty" id="w-qty"><%= WishlistQty %></span>
                                      <span class="ti-heart"></span>
                                  </div>
                              </a>
                          </li>
                          <li class="nav-item">
                              <a href="/cart" class="cart nav-link">
                                  <div class="cart-container">
                                      <span class="qty" id="cart-quantity"><%= cartQty %></span>
                                      <span class="ti-bag"></span>
                                  </div>
                              </a>
                          </li>
                          <li class="nav-item ">
                              <a href="/wallet" class="cart nav-link">
                                  <div class="cart-container">
                                      <span class="ti-wallet"></span>
                                  </div>
                              </a>
                          </li>
                      </ul>
  
                      <ul class="navbar-nav">
                          <li class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  <% if (user) { %>
                                      <%= user.username %>
                                  <% } else { %>
                                      LOGIN
                                  <% } %>
                              </a>
                              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                  <% if (user) { %>
                                      <a class="dropdown-item" href="/profile">Profile</a>
                                      <div class="dropdown-divider"></div>
                                      <form action="/logout" method="POST">
                                          <button type="submit" class="dropdown-item">Logout</button>
                                      </form>
                                  <% } else { %>
                                      <a class="dropdown-item" href="/login">Login</a>
                                  <% } %>
                              </div>
                          </li>
                      </ul>
                  </div>
              </div>
          </nav>
      </div>
  </header>
    <section class="banner-area organic-breadcrumb">
      <div class="container">
        <div
          class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end"
        >
          <div class="col-first">
            <h1>Product Details</h1>
            <nav class="d-flex align-items-center">
              <a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
              <a href="/singleproduct/<%= product._id %>">Product Details</a>
            </nav>
          </div>
        </div>
      </div>
    </section>

    <div class="container mt-4 p-5">
      <div class="row mt-5">
        <div class="col-md-6 mt-5">
          <div class="zoom-container">
            <img
              id="main-image"
              src="<%= product.images[0].url %>"
              alt="<%= product.name %>"
              class="img-fluid"
            />
            <div id="zoomed-image" class="zoomed-image"></div>
            <div id="focus-area" class="focus-area"></div>
          </div>

          <div class="thumbnails d-flex">
            <% product.images.slice(0, 4).forEach(image => { %>
            <img
              src="<%= image.url %>"
              alt="<%= product.name %>"
              class="thumbnail-img"
            />
            <% }) %>
          </div>
        </div>

        <div class="col-md-6 p-5">
          <h1 class="product-title"><%= product.name %></h1>
          <strong><p class="product-price">₹ <%= product.price %></p></strong>
          
          <% if (product.categoryId) { %>
            <p><strong>Category:</strong> <%= product.categoryId.name %></p> 
          <% } %>
        
          <p>
            <% 
              const allOutOfStock = product.availableSize.every(sizeObj => sizeObj.stock === 0); 
              const allStockLessThan20 = product.availableSize.every(sizeObj => sizeObj.stock < 20);
            %>
            <strong>Available Sizes:</strong>
            
            <% if (allOutOfStock) { %>
              <span class="text-danger">Out of Stock</span>
            <% } else { %>
              <select id="sizeSelect" class="form-select mb-3">
                <% product.availableSize.forEach(sizeObj => { %> 
                  <% if (sizeObj.stock > 0) { %>
                    <option value="<%= sizeObj.size %>"><%= sizeObj.size %> </option>
                  <% } %> 
                <% }) %>
              </select>
        
              <% if (allStockLessThan20) { %>
                <p style="color: red">Few products are left!</p>
              <% } %>
            <% } %>
          </p>
        
          <span class="ratingT">
            <%= "★".repeat(Math.round(averageRating)) %> <%= "☆".repeat(5 - Math.round(averageRating)) %>
          </span>
          <br>  
          <strong class="product-description"><%= product.description %></strong>
          
          <% if (allOutOfStock) { %>
            <button
              class="btn btn-warning w-100"
              onclick="addToWishList('<%= product._id %>')"
            >
              Add to Wishlist
            </button>
          <% } else { %>
            <button
              class="btn btn-warning w-100"
              onclick="addToWishList('<%= product._id %>')"
            >
              Add to Wishlist
            </button>
            <button
              class="btn btn-dark w-100 mt-2"
              onclick="addToCart(event,'<%= product._id %>', document.getElementById('sizeSelect').value)"
            >
              Add to Cart
            </button>
          <% } %>
        </div>
        
        
      </div>

      <!-- Reviews Section -->
      <div class="review-section mt-5">
        <h3>Verified Customer Reviews</h3>

        <div class="reviews-list" id="reviewsContainer"></div>

        <div class="pagination">
          <a href="#" class="prev-arrow" id="prevPage">
            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
          </a>
          <span id="paginationLinks"></span>
          <a href="#" class="next-arrow" id="nextPage">
            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
          </a>
        </div>

        <div id="imageModal" class="modal" style="display: none">
          <span class="close" id="closeModal">&times;</span>
          <img class="modal-content" id="modalImage" alt="Review Image" />
          <div id="caption"></div>
        </div>

        <div class="review-container">
          <h2 class="text-center mb-4">Submit Your Review</h2>
          <form id="reviewForm" enctype="multipart/form-data">
            <input type="text" hidden value="<%= product._id %>" id="p-id" />
            <div class="form-group">
              <label for="name">Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                placeholder="Enter your name"
                required
              />
            </div>

            <div class="form-group">
              <label for="rating">Rating</label>
              <select class="form-control" id="rating">
                <option value="" disabled selected>Select Rating</option>
                <option value="1">1 <i class="fas fa-star"></i></option>
                <option value="2">
                  2 <i class="fas fa-star"></i><i class="fas fa-star"></i>
                </option>
                <option value="3">
                  3 <i class="fas fa-star"></i><i class="fas fa-star"></i
                  ><i class="fas fa-star"></i>
                </option>
                <option value="4">
                  4 <i class="fas fa-star"></i><i class="fas fa-star"></i
                  ><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </option>
                <option value="5">
                  5 <i class="fas fa-star"></i><i class="fas fa-star"></i
                  ><i class="fas fa-star"></i><i class="fas fa-star"></i
                  ><i class="fas fa-star"></i>
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="review">Review</label>
              <textarea
                class="form-control"
                id="review"
                rows="4"
                placeholder="Write your review here..."
              ></textarea>
            </div>

            <div class="form-group">
              <label for="image">Add Image (optional)</label>
              <input
                type="file"
                class="form-control-file"
                id="image"
                accept="image/*"
              />
            </div>
            <span class="mb-3">You can only submit one review per product.</span
            ><br />
            <button
              type="submit"
              class="btn border-dark badge-light"
              style="background-color: yellowgreen"
              id="reviewBtnHandler"
            >
              Submit Review
            </button>
          </form>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/vendor/bootstrap.min.js"></script>
    <script src="/js/jquery.ajaxchimp.min.js"></script>
    <script src="/js/jquery.nice-select.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>
    <script src="/js/nouislider.min.js"></script>
    <script src="/js/countdown.js"></script>
    <script src="/js/jquery.magnific-popup.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/main.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script type="module" src="/user/js/singleProduct.js"></script>
  </body>
</html>
