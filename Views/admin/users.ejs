<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <title>Nexus Admin | Users</title>
    <link rel="stylesheet" href="/admin/css/users.css?v=1.1">
</head>
<body class="sidebar-page">
    <div class="container-fluid">
        <div class="row">
            <%- include('partials/sideBar') %>

            <main class="content-wrapper">
                <div class="d-flex justify-content-between align-items-center mb-5">
                    <div>
                        <h1 class="h3 fw-bold mb-0">Users Management</h1>
                        <p class="text-muted small mb-0">View and manage all registered customers.</p>
                    </div>
                </div>

                <div class="card p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="search-box position-relative" style="width: 300px;">
                            <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                            <input
                                id="searchInput"
                                class="form-control ps-5"
                                type="text"
                                placeholder="Search by name or email..."
                            />
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th class="ps-3 text-uppercase small letter-spacing-1">Customer</th>
                                    <th class="text-uppercase small letter-spacing-1">Email</th>
                                    <th class="text-uppercase small letter-spacing-1">Auth Type</th>
                                    <th class="text-end pe-3 text-uppercase small letter-spacing-1">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <% Users.forEach(user => { %>
                                    <tr 
                                        data-username="<%= user.username.toLowerCase() %>"
                                        data-email="<%= user.email.toLowerCase() %>"
                                    >
                                        <td class="ps-3">
                                            <div class="fw-medium text-dark"><%= user.username %></div>
                                        </td>
                                        <td>
                                            <span class="text-muted small"><%= user.email %></span>
                                        </td>
                                        <td>
                                            <span class="badge <%= user.googleUser ? 'bg-info-subtle text-info' : 'bg-secondary-subtle text-muted' %>">
                                                <%= user.googleUser ? 'Google' : 'Password' %>
                                            </span>
                                        </td>
                                        <td class="text-end pe-3">
                                            <button
                                                class="btn btn-sm btn-<%= user.block ? 'danger' : 'success' %> toggle-block-btn"
                                                data-id="<%= user._id %>"
                                            >
                                                <%= user.block ? 'Unblock' : 'Block' %>
                                            </button>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <% if (totalPages > 1) { %>
                    <nav class="mt-4">
                        <ul class="pagination justify-content-center mb-0">
                            <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                <a class="page-link border-0 bg-light rounded-start-pill px-4" href="/admin/users?page=<%= currentPage - 1 %>">
                                    <i class="bi bi-chevron-left small me-1"></i>Prev
                                </a>
                            </li>
                            <li class="page-item active mx-2">
                                <span class="page-link border-0 rounded-circle shadow-sm"><%= currentPage %></span>
                            </li>
                            <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                <a class="page-link border-0 bg-light rounded-end-pill px-4" href="/admin/users?page=<%= currentPage + 1 %>">
                                    Next<i class="bi bi-chevron-right small ms-1"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <% } %>
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <%- include('partials/scripts') %>
    <!-- Page JS -->
    <script type="module" src="/admin/js/users.js"></script>
</body>
</html>
