<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Add Product</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .sidebar {
        height: 100vh;
        background-color: #343a40;
        padding-top: 20px;
      }
      .sidebar a {
        color: #ffffff;
        text-decoration: none;
        display: block;
        padding: 10px 20px;
      }
      .sidebar a:hover {
        background-color: #495057;
      }
      .form-container {
        margin: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <%- include('partials/sidebar') %>
        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div class="form-container">
            <h2>Add New Product</h2>
            <form
              action="/admin/products/add-products"
              method="post"
              enctype="multipart/form-data"
            >
              <div class="mb-3">
                <label for="productName" class="form-label">Product Name</label>
                <input
                  type="text"
                  name="name"
                  class="form-control"
                  id="productName"
                  placeholder="Enter product name"
                  required
                  value="<%= product.name%>"
                />
              </div>
              <div class="mb-3">
                <label for="brandName" class="form-label">Brand Name</label>
                <input
                  type="text"
                  name="brand"
                  class="form-control"
                  id="brandName"
                  placeholder="Enter brand name"
                  required
                  value="<%= product.brand%>"
                />
              </div>
              <div class="mb-3">
                <label for="availableSizes" class="form-label"
                  >Available Sizes (comma separated)</label
                >
                <input
                type="text"
                name="sizes"
                class="form-control"
                id="availableSizes"
                placeholder="Enter sizes, e.g., 37,38,39,40"
                required
                value="<%= product.availableSize ? product.availableSize.join(',') : '' %>"
              />
              </div>
              <div class="mb-3">
                <label for="productDescription" class="form-label"
                  >Description</label
                >
                <input 
                type="text" 
                name="description" 
                class="form-control" 
                id="productDescription" 
                placeholder="Enter product description" 
                value="<%= product.description %>" 
                required
              />
              </div>
              <div class="row">  
                <div class="col-md-6 mb-3">
                  <label for="productPrice" class="form-label">Price</label>
                  <input
                    type="number"
                    name="price"
                    class="form-control"
                    id="productPrice"
                    placeholder="Enter price"
                    min="1"
                    required
                    value="<%= product.price %>"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="productStock" class="form-label">Stock</label>
                  <input
                    type="number"
                    name="stock"
                    class="form-control"
                    id="productStock"
                    placeholder="Enter stock quantity"
                    min="1"
                    required
                    value="<%= product.stock %>"
                  />
                </div>
              </div>
              <div class="mb-3">
                <label for="productCategory" class="form-label">Category</label>
                <select class="form-select" id="productCategory" name="category" required>
                    <option value=""><%= product.categoryId.name %></option>
                    <% categories.forEach(category => { %>
                    <option value="<%= category._id %>" <%= (category._id.toString() === product.categoryId.name.toString()) ? 'selected' : '' %>>
                        <%= category.name %>
                    </option>
                    <% }) %>
                </select>
            </div>
            
              <!-- Image Upload Fields -->
              <div class="d-flex flex-wrap" id="previewContainer">
                <% if (product.images && product.images.length) { %>
                    <% product.images.forEach((image, index) => { %>
                        <div class="position-relative" id="imageContainer<%= index %>">
                            <img src="<%= product.images[index].replace('public', '') %>" class="image-preview" data-index="<%= index %>" onclick="triggerFileUpload(<%= index %>)" />
                            <input type="file" class="file-input" id="fileInput<%= index %>" onchange="handleFileChange(event, <%= index %>)" style="display: none;" accept="image/*" />
                        </div>
                    <% }) %>
                <% } else { %>
                    <p>No images available.</p>
                <% } %>
            </div>
            
              
            </div>
              <button type="submit" class="btn btn-dark" id="submit-btn">
                Add Product
              </button>
            </form>
          </div>
        </main>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    ></script>
    <script>
    // Function to trigger the file upload when an image is clicked
function triggerFileUpload(index) {
    const fileInput = document.getElementById(`fileInput${index}`);
    fileInput.click(); // Trigger the hidden file input
}

// Function to handle the file change event
function handleFileChange(event, index) {
    const file = event.target.files[0];
    // Validate if the selected file is an image
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = document.querySelector(`img[data-index="${index}"]`);
            img.src = e.target.result; // Update the image preview with the new file
        };
        reader.readAsDataURL(file); // Read the file as a Data URL
    } else {
        alert('Please select a valid image file.'); // Alert for invalid file type
        event.target.value = ''; // Clear the file input
    }
}

      document.getElementById("submit-btn").addEventListener("click", (e) => {
        const stock = document.getElementById("productStock").value;
        const price = document.getElementById("productPrice").value;
        let errorMessage = "";

        if (stock < 1) {
          errorMessage += "Stock must be greater than 0.\n";
        }

        
        if (price < 1) {
          errorMessage += "Price must be greater than 0.\n";
        }

       
        if (errorMessage) {
          e.preventDefault();
          alert(errorMessage.trim());
        }
      });
    </script>
  </body>
</html>
